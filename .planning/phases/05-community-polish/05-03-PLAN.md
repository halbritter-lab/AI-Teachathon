---
phase: 05-community-polish
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - tests/playwright.config.ts
  - tests/links.spec.ts
  - tests/responsive.spec.ts
  - package.json
  - Makefile
autonomous: false

must_haves:
  truths:
    - "All internal cross-links return 200 status codes"
    - "All pages render without horizontal scroll at 375px width"
    - "Presentation renders Marp slides at 1024x768 viewport"
    - "Mobile navigation works (menu opens, links navigate)"
    - "Playwright tests can be run with a single npm command"
  artifacts:
    - path: "tests/playwright.config.ts"
      provides: "Multi-device Playwright configuration"
      contains: "projects"
    - path: "tests/links.spec.ts"
      provides: "Link validation tests"
      contains: "expect.soft"
    - path: "tests/responsive.spec.ts"
      provides: "Responsive design and presentation tests"
      contains: "viewport"
    - path: "package.json"
      provides: "Playwright devDep and test script"
      contains: "playwright"
  key_links:
    - from: "tests/playwright.config.ts"
      to: "package.json"
      via: "webServer command referencing npm script"
      pattern: "docs:dev"
    - from: "tests/links.spec.ts"
      to: "/AI-Teachathon/"
      via: "page.goto with base URL"
      pattern: "page\\.goto"
    - from: "tests/responsive.spec.ts"
      to: "/AI-Teachathon/presentation.html"
      via: "page.goto for presentation test"
      pattern: "presentation\\.html"
---

<objective>
Set up Playwright for end-to-end testing and write tests that validate cross-links, responsive design, and presentation rendering across multiple devices. Run tests and fix any issues found.

Purpose: Final QA pass ensures the complete site works before launch -- all links resolve, pages are readable on mobile, and the presentation renders correctly.
Output: Working Playwright test suite, all tests passing, any discovered issues fixed.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-community-polish/05-CONTEXT.md
@.planning/phases/05-community-polish/05-RESEARCH.md
@.planning/phases/05-community-polish/05-01-SUMMARY.md
@.planning/phases/05-community-polish/05-02-SUMMARY.md
@package.json
@Makefile
@docs/.vitepress/config.mts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create test configuration</name>
  <files>package.json, tests/playwright.config.ts</files>
  <action>
Install Playwright as a dev dependency and set up the test configuration.

**Install:**
```bash
npm install -D @playwright/test
npx playwright install chromium
```

Only install chromium browser (not firefox/webkit) to keep install fast. The cross-link and responsive tests don't need multi-browser coverage -- chromium is sufficient for validating links and layout.

**Add npm script to package.json:**
Add to the "scripts" section:
```json
"test": "playwright test",
"test:ui": "playwright test --ui"
```

**Create tests/playwright.config.ts:**
```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: '.',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',

  use: {
    baseURL: 'http://localhost:5173/AI-Teachathon/',
    trace: 'on-first-retry',
  },

  webServer: {
    command: 'npm run docs:dev',
    url: 'http://localhost:5173/AI-Teachathon/',
    reuseExistingServer: !process.env.CI,
    timeout: 30000,
  },

  projects: [
    {
      name: 'desktop',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'mobile',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'presentation',
      use: {
        viewport: { width: 1024, height: 768 },
        deviceScaleFactor: 1,
      },
    },
  ],
})
```

Keep projects minimal: desktop, mobile, and presentation. This covers the key viewports from the requirements (desktop, 375px-class mobile, 1024x768 presentation) without excessive test time.

**Add to Makefile:**
Add a `test` target after the `check` target:
```makefile
test: ## Run Playwright E2E tests
	npm test
```
Update the `check` target to NOT include tests (tests require a running server and are slower -- keep check fast for CI lint/format/build).

**Add test artifacts to .gitignore or note:** The Playwright HTML report (playwright-report/) and test results (test-results/) directories should be in .gitignore if not already.
  </action>
  <verify>
- `npx playwright --version` returns version info
- `tests/playwright.config.ts` exists with 3 projects defined
- `npm test -- --list` lists available test files (may show 0 if no spec files yet)
- `package.json` has "test" script
  </verify>
  <done>Playwright installed with chromium, config defines desktop/mobile/presentation projects, npm test script works</done>
</task>

<task type="auto">
  <name>Task 2: Write link validation and responsive tests</name>
  <files>tests/links.spec.ts, tests/responsive.spec.ts</files>
  <action>
**Create tests/links.spec.ts:**

Test that all internal cross-links across the site return valid responses. Use soft assertions to report all failures, not just the first one.

```typescript
import { test, expect } from '@playwright/test'

const sitePages = [
  '/',
  '/setup',
  '/agenda',
  '/ideas',
  '/resources',
  '/ai-tools',
  '/hands-on',
  '/slides',
]

for (const pagePath of sitePages) {
  test(`internal links on ${pagePath}`, async ({ page }) => {
    await page.goto(pagePath)
    await page.waitForLoadState('networkidle')

    const allLinks = await page.locator('a[href]').all()
    const hrefs = await Promise.all(
      allLinks.map((link) => link.getAttribute('href'))
    )

    // Filter to internal links only (start with / or are relative)
    const internalHrefs = hrefs.reduce((links, href) => {
      if (
        href &&
        !href.startsWith('http') &&
        !href.startsWith('mailto:') &&
        !href.startsWith('#')
      ) {
        // Normalize: resolve relative to current page
        const resolved = new URL(href, page.url()).href
        links.add(resolved)
      }
      return links
    }, new Set<string>())

    for (const url of internalHrefs) {
      const response = await page.request.get(url)
      expect
        .soft(response.status(), `${url} should return 200-299`)
        .toBeGreaterThanOrEqual(200)
      expect
        .soft(response.status(), `${url} should return 200-299`)
        .toBeLessThan(400)
    }
  })
}
```

Only test INTERNAL links. External link validation is separate (rate limits, flakiness). Internal links are what we control and must work.

Run this test with the desktop project only (no need to check links on every device):
Add `test.describe.configure({ mode: 'serial' })` or use a project filter annotation if needed.

**Create tests/responsive.spec.ts:**

Test responsive design at key viewports and presentation rendering.

```typescript
import { test, expect } from '@playwright/test'

test.describe('Responsive design', () => {
  test('no horizontal scroll on ideas page', async ({ page }) => {
    await page.goto('/ideas')
    await page.waitForLoadState('networkidle')

    const bodyScrollWidth = await page.evaluate(() => document.body.scrollWidth)
    const viewportWidth = page.viewportSize()?.width ?? 0
    expect(bodyScrollWidth).toBeLessThanOrEqual(viewportWidth + 1) // 1px tolerance
  })

  test('no horizontal scroll on resources page', async ({ page }) => {
    await page.goto('/resources')
    await page.waitForLoadState('networkidle')

    const bodyScrollWidth = await page.evaluate(() => document.body.scrollWidth)
    const viewportWidth = page.viewportSize()?.width ?? 0
    expect(bodyScrollWidth).toBeLessThanOrEqual(viewportWidth + 1)
  })

  test('all main pages render without errors', async ({ page }) => {
    const pages = ['/', '/setup', '/agenda', '/ideas', '/resources']
    for (const pagePath of pages) {
      const errors: string[] = []
      page.on('pageerror', (err) => errors.push(err.message))

      await page.goto(pagePath)
      await page.waitForLoadState('networkidle')

      expect.soft(errors, `${pagePath} should have no JS errors`).toEqual([])
    }
  })
})

test.describe('Presentation', () => {
  test('renders Marp slides at 1024x768', async ({ page }) => {
    await page.goto('/presentation.html', { waitUntil: 'networkidle' })

    // Verify Marp slides rendered
    const slides = page.locator('svg[data-marpit-svg]')
    await expect(slides.first()).toBeVisible({ timeout: 10000 })

    // Verify multiple slides exist
    const slideCount = await slides.count()
    expect(slideCount).toBeGreaterThan(1)
  })
})
```

**Important implementation notes:**
- Use `page.waitForLoadState('networkidle')` to ensure VitePress SPA has finished loading
- The presentation test should use the `presentation` project (1024x768 viewport)
- The responsive tests run on the `mobile` project (Pixel 5 viewport)
- Link tests run on the `desktop` project

After writing both test files, run:
```bash
npm test
```

If any tests fail, analyze the failures:
- Broken internal links: fix the source page (update the link href)
- Horizontal scroll: may need CSS fix in the content pages
- Presentation errors: check that `docs/public/presentation.html` exists (run `npm run build:marp` first if needed)
- JS errors: investigate and fix

Fix any issues found, then re-run tests until all pass.
  </action>
  <verify>
- `npm test` passes (all tests green)
- Test output shows tests ran across desktop, mobile, and presentation projects
- No broken internal links reported
- No horizontal scroll issues on mobile
- Presentation renders at 1024x768
  </verify>
  <done>All Playwright tests pass: internal links valid, no horizontal scroll on mobile, presentation renders, no JS errors on any page</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 5 deliverables:
1. Ideas page with KidneyQuest featured project, 4 alternative ideas, pain points section, and contribution invitation
2. Resources page with journey-organized links (Before/During/After + Explore Further)
3. Edit-on-GitHub link enabled globally on all pages
4. Playwright test suite validating cross-links, responsive design, and presentation rendering
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run docs:dev`
2. Check the Ideas page (http://localhost:5173/AI-Teachathon/ideas):
   - KidneyQuest is prominently featured at the top
   - 4 alternative project ideas listed below with stack info
   - "What Could AI Help With?" section with pain points
   - Contribution invitation at the bottom with edit link
   - "Edit this page on GitHub" link appears in the page footer
3. Check the Resources page (http://localhost:5173/AI-Teachathon/resources):
   - Organized by Before/During/After the Event + Explore Further
   - Links are titles only, no descriptions
   - Internal cross-links to /setup, /ai-tools, /hands-on work
4. Spot-check other pages for the "Edit this page on GitHub" footer link
5. Test on mobile: resize browser to ~375px width, verify no horizontal scroll
6. Verify the overall site feels complete and polished
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npm run docs:build` succeeds (full site builds)
- `npm test` passes (all Playwright tests green)
- `npm run lint` passes
- `npm run format:check` passes
- Ideas page has all required content sections
- Resources page has journey-organized links
- editLink appears on all pages
- No broken internal links
- No horizontal scroll on mobile
- Presentation renders at 1024x768
</verification>

<success_criteria>
- All internal cross-links work (validated by Playwright)
- Site readable on mobile with no horizontal scroll (validated by Playwright)
- Presentation renders at 1024x768 (validated by Playwright)
- Ideas and resources pages complete with all content from context decisions
- editLink globally enabled
- Full test suite passing and runnable via `npm test`
</success_criteria>

<output>
After completion, create `.planning/phases/05-community-polish/05-03-SUMMARY.md`
</output>
