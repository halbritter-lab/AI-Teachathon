# Phase 3: Presentation - Research

**Researched:** 2026-02-16
**Domain:** Marp markdown presentation framework
**Confidence:** HIGH

## Summary

Marp is a markdown-based presentation ecosystem that converts Markdown files to HTML, PDF, and PowerPoint presentations. The decision to use Marp over Reveal.js (per CONTEXT.md) simplifies the workflow by maintaining consistency with VitePress's Markdown-first approach. Marp CLI (v4.2.3, latest as of 6 months ago) provides command-line conversion capabilities with extensive theming options.

The standard approach for integrating Marp into a VitePress project is to generate standalone HTML from Markdown using Marp CLI as part of the build process, then link to the generated HTML from VitePress pages. Marp uses the same markdown-it parser underlying VitePress, but with presentation-specific extensions (directives, slide separators, speaker notes).

For this project's requirements (dark academic theme with teal/cyan accents, ~30-minute presentation with ~25 slides), the Gaia built-in theme with the `invert` class provides an excellent foundation. Custom theme CSS can overlay teal/cyan accent colors using CSS variables.

**Primary recommendation:** Use Marp CLI with a custom theme extending Gaia's invert mode, generate standalone HTML via npm script, and integrate the output into VitePress's public directory for deployment.

## Standard Stack

The established libraries/tools for this domain:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @marp-team/marp-cli | 4.2.3 | Markdown to presentation converter | Official CLI tool, converts to HTML/PDF/PPTX with theming support |
| @marp-team/marp-core | Latest | Conversion engine | Powers all official Marp tools, built on Marpit framework |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| Marpit framework | Latest | Slide deck transformation | Underlying framework, rarely used directly |
| monolith | Latest (CLI tool) | Bundle assets into single HTML | Optional: when truly self-contained HTML needed (images, fonts) |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Marp | Reveal.js | Reveal.js requires JavaScript setup, less markdown-native. Marp chosen per CONTEXT.md |
| Marp | Slidev | Slidev is Vue-based, heavier, more features. Marp simpler for markdown-first workflow |

**Installation:**
```bash
npm install --save-dev @marp-team/marp-cli
```

## Architecture Patterns

### Recommended Project Structure
```
docs/
├── .vitepress/
│   ├── config.mts           # VitePress config
│   └── theme/
│       └── marp-theme.css   # Custom Marp theme
├── public/
│   └── presentation.html    # Generated by Marp CLI (gitignored or committed)
├── presentation/
│   └── slides.md            # Source Markdown for Marp
└── index.md                 # VitePress landing page (links to presentation.html)
```

### Pattern 1: Build Script Integration
**What:** Use npm scripts to generate Marp HTML as part of VitePress build
**When to use:** When presentation should be deployed alongside documentation
**Example:**
```json
// package.json
{
  "scripts": {
    "docs:dev": "vitepress dev docs",
    "docs:build": "npm run build:marp && vitepress build docs",
    "build:marp": "marp presentation/slides.md -o docs/public/presentation.html --theme docs/.vitepress/theme/marp-theme.css --html"
  }
}
```

### Pattern 2: Marp Frontmatter Configuration
**What:** Use YAML frontmatter at start of Markdown for global directives
**When to use:** Always, for theme and presentation-wide settings
**Example:**
```markdown
---
marp: true
theme: gaia
class: invert
paginate: true
backgroundColor: #1a1a1a
footer: 'AI-Teachathon | Halbritter Lab'
---

# First Slide
Content here...

---

# Second Slide
More content...
```

### Pattern 3: Dark Theme with Custom Accents
**What:** Extend Gaia's invert class with CSS variable overrides
**When to use:** When built-in themes need color customization
**Example:**
```css
/* Source: Community patterns from Cybertopia theme */
/* docs/.vitepress/theme/marp-theme.css */
@import 'gaia';

:root.invert {
  --color-background: #1a1a1a;
  --color-foreground: #ffffff;
  --color-highlight: #02c797;  /* teal/cyan accent */
  --color-highlight-hover: #04e6af;

  /* Link and border accent */
  a { color: var(--color-highlight); }
  a:hover { color: var(--color-highlight-hover); }

  /* Pagination accent */
  section::after {
    color: var(--color-highlight);
  }
}
```

### Pattern 4: Speaker Notes with HTML Comments
**What:** Add speaker notes using HTML comment syntax
**When to use:** When presenter needs reminders (viewable in HTML mode, exportable to PDF with --pdf-notes)
**Example:**
```markdown
---

## Git Basics

- Commits save snapshots
- Branches enable parallel work
- Pull requests facilitate review

<!--
Remind audience: commits are like save points in a game
Keep this section to 3 minutes max
-->

---
```

### Anti-Patterns to Avoid
- **Using multiple theme CSS files without @import hierarchy:** Causes unpredictable style conflicts. Use single custom theme that imports base theme.
- **Enabling HTML without --html flag:** HTML will be encoded by default for security. Must explicitly enable with CLI flag.
- **Applying local directives globally:** Directives like `backgroundColor` are local (per-slide). Use frontmatter for global settings.
- **Using dash (-) for incremental lists:** Fragmented lists require asterisk (*) for bullets, ) for numbered lists.

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Theme dark mode toggle | Custom JavaScript for color switching | Gaia theme's `invert` class | Built-in, tested, works with all themes |
| Slide transitions | Custom CSS animations | Marp CLI `transition` directive (33 effects) | Requires View Transitions API, handles browser compat |
| Self-contained HTML | Custom asset bundling | monolith CLI tool | Bundles images, fonts, CSS into single file reliably |
| Presenter view | Custom dual-window setup | Marp's built-in presenter mode (p key) | Opens external window with notes, timer, preview |
| Keyboard navigation | Custom event handlers | Marp's bespoke template | Arrow keys, Home/End, 1-9 for jump, f for fullscreen, ? for help |

**Key insight:** Marp's bespoke HTML template includes extensive presentation controls and accessibility features. Custom implementations will miss edge cases like reduce-motion preferences, touch gestures, and keyboard-only navigation.

## Common Pitfalls

### Pitfall 1: Directive Inheritance Confusion
**What goes wrong:** Setting a local directive (e.g., `backgroundColor`) on slide 3 unintentionally affects slides 4-25.
**Why it happens:** Local directives inherit to subsequent slides unless explicitly overridden or scoped with underscore prefix.
**How to avoid:** Use scoped directives (`_backgroundColor: blue`) for single-slide application, or explicitly reset on next slide.
**Warning signs:** Unexpected styling appearing on later slides; footer/header showing where not intended.

### Pitfall 2: HTML Security Blocking
**What goes wrong:** HTML tags appear as literal text in presentation instead of rendering.
**Why it happens:** Marp CLI disables HTML rendering by default for security (prevents script injection).
**How to avoid:** Add `--html` flag to CLI command when HTML elements are needed. Verify no untrusted content in Markdown.
**Warning signs:** `<div>`, `<span>`, or other HTML visible as text in slides.

### Pitfall 3: Image Path Resolution
**What goes wrong:** Images display in VS Code Marp preview but not in generated HTML.
**Why it happens:** Relative paths work in preview but fail when HTML is moved to different directory (e.g., `docs/public/`).
**How to avoid:** Use `--allow-local-files` flag for local images, or use absolute paths from project root. Better: place images in VitePress public directory and reference with absolute paths.
**Warning signs:** Broken image icons in generated HTML; images in background directives not appearing.

### Pitfall 4: VitePress vs Marp Markdown Conflicts
**What goes wrong:** VitePress-specific markdown extensions (e.g., custom containers `:::`) appear in Marp slides.
**Why it happens:** Marp doesn't process VitePress extensions; they're passed through as literal text.
**How to avoid:** Keep Marp presentation Markdown separate from VitePress content. Don't mix VitePress-specific syntax in slides.md.
**Warning signs:** Triple-colon blocks or Vue components appearing as text in presentation.

### Pitfall 5: Theme CSS Variable Scope
**What goes wrong:** Custom CSS variables not applying; theme looks unchanged.
**Why it happens:** Variables must be scoped to `:root.invert` for inverted themes, not just `:root`.
**How to avoid:** Check theme's base class (invert, gaia, lead) and scope variables accordingly. Use browser DevTools to verify.
**Warning signs:** Custom colors defined in CSS but presentation still shows default theme colors.

### Pitfall 6: Fragmented List Syntax
**What goes wrong:** Bullet points don't appear incrementally; all show at once.
**Why it happens:** Fragmented lists require specific markers: `*` for bullets (not `-` or `+`), `)` for numbered lists (not `.`).
**How to avoid:** Use `*` consistently for incremental bullets. Test in HTML output, not just VS Code preview.
**Warning signs:** All list items visible immediately; no fragment animation in browser.

## Code Examples

Verified patterns from official sources:

### Complete Frontmatter Example
```yaml
# Source: https://github.com/marp-team/marp/blob/main/website/docs/guide/directives.md
---
marp: true
theme: gaia
class: invert
size: 16:9
paginate: true
header: 'AI-Teachathon | Halbritter Lab'
footer: 'Git, GitHub & AI Tools'
backgroundColor: #1a1a1a
color: #ffffff
---
```

### Custom Theme with Teal Accents
```css
/* Source: Adapted from https://github.com/noraj/cybertopia-marp */
/* File: docs/.vitepress/theme/marp-theme.css */
@import 'gaia';

:root.invert {
  --color-background: #1a1a1a;
  --color-background-code: #0d0d0d;
  --color-foreground: #ffffff;
  --color-header: rgba(255, 255, 255, 0.6);
  --color-highlight: #02c797;  /* teal primary */
  --color-highlight-hover: #04e6af;  /* lighter teal */
  --color-dimmed: #c6c6c6;
}

section {
  background-color: var(--color-background);
  color: var(--color-foreground);
}

/* Accent teal on links */
a {
  color: var(--color-highlight);
  text-decoration: none;
  border-bottom: 2px solid var(--color-highlight);
}

a:hover {
  color: var(--color-highlight-hover);
  border-bottom-color: var(--color-highlight-hover);
}

/* Pagination styling */
section::after {
  color: var(--color-highlight);
  font-weight: 600;
}

/* Header/footer styling */
header, footer {
  color: var(--color-header);
}

/* Code block contrast */
pre {
  background-color: var(--color-background-code);
  border: 1px solid var(--color-highlight);
}

/* Large text for readability */
section {
  font-size: 1.8rem;
}

h1 {
  font-size: 3.2rem;
  color: var(--color-highlight);
}

h2 {
  font-size: 2.4rem;
  border-bottom: 3px solid var(--color-highlight);
  padding-bottom: 0.5rem;
}
```

### Slide with Scoped Background
```markdown
# Source: https://marpit.marp.app/directives
---

<!-- _backgroundColor: #2a2a2a -->
<!-- _class: lead -->

# Special Slide

This slide has dark background and centered content.
Next slide returns to default styling.

---

# Regular Slide

Back to inherited global settings.
```

### Linking to Presentation from VitePress
```markdown
<!-- Source: CONTEXT.md requirement for "back to course" link -->
<!-- File: docs/index.md -->

## Workshop Materials

- [Setup Guide](/setup)
- [**Presentation Slides**](/presentation.html) ← Opens Marp presentation
- [Hands-On Activity](/hands-on)

The presentation opens in fullscreen-capable mode. Press `f` for fullscreen, `?` for keyboard shortcuts.
```

### npm Build Script Pattern
```json
// Source: Community pattern from https://medium.com/@75py/creating-slides-with-marp-13dc35e36e4c
{
  "scripts": {
    "docs:dev": "concurrently \"npm run dev:marp\" \"vitepress dev docs\"",
    "docs:build": "npm run build:marp && vitepress build docs",
    "dev:marp": "marp presentation/slides.md -o docs/public/presentation.html --theme docs/.vitepress/theme/marp-theme.css --html --watch",
    "build:marp": "marp presentation/slides.md -o docs/public/presentation.html --theme docs/.vitepress/theme/marp-theme.css --html"
  }
}
```

### Slide Transitions
```markdown
# Source: https://github.com/marp-team/marp-cli/blob/main/docs/bespoke-transitions/README.md
---
transition: fade
---

# Slide with Fade Transition

Next slide boundary will fade in.

---
transition: slide
---

# Slide with Slide Transition

Slides from right to left.

<!-- Available transitions: none, fade, slide, push, pull, cover, reveal, wipe,
     clockwise, counterclockwise, rotate, flip, cube, cylinder, explode, zoom, etc. -->
```

### Image as Background
```markdown
# Source: https://marpit.marp.app/image-syntax
---

![bg](./assets/hero-image.jpg)

# Title Over Background

---

![bg right:40%](./assets/diagram.png)

# Content with Split Background

Text on left, image on right (40% width).
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Desktop Marp app | Marp CLI + VS Code extension | ~2019 | Desktop app had security vulnerability (arbitrary code execution). CLI is maintained, secure |
| Manual slide breaks only | headingDivider directive | Marp Next (2018+) | Can auto-generate slides from existing markdown documents |
| Static CSS themes | CSS variable customization | Gaia v2.0 (2020) | Easier theme customization without full theme rewrite |
| JavaScript slide transitions | View Transitions API | Marp CLI v2.0 (2022) | 33 built-in transitions, browser-native, reduce-motion aware |

**Deprecated/outdated:**
- **Classic Marp desktop app (yhatt/marp):** Security vulnerability CVE-2018-20304. Use Marp CLI or Marp for VS Code instead.
- **Fragmented lists with dash (-):** Changed to asterisk (*) for bullets. Old syntax no longer creates fragments.
- **Marpit API direct usage in presentations:** Marpit is framework; use Marp Core/CLI for presentations.

## Open Questions

Things that couldn't be fully resolved:

1. **VitePress markdown-it plugin integration for Marp processing**
   - What we know: VitePress uses markdown-it parser, supports custom plugins via config.mts
   - What's unclear: Whether Marp's Marpit can be integrated as markdown-it plugin to process Marp directives within VitePress pages
   - Recommendation: Stick with standalone Marp CLI approach (proven pattern). VitePress integration would be experimental, high complexity. Community hasn't documented this pattern.

2. **Optimal placement for generated presentation.html**
   - What we know: VitePress `public/` directory copies files to dist root. Presentation could go there or in separate presentations/ folder.
   - What's unclear: Whether to gitignore generated HTML (build artifact) or commit it (ensures consistency)
   - Recommendation: Commit to `docs/public/presentation.html` if presentation changes infrequently and CI/CD isn't set up. Gitignore if automated builds in place. For this workshop (Feb 17), commit it for simplicity.

3. **Tailwind CSS conflicts with Marp themes**
   - What we know: VitePress site uses Tailwind v4 via @tailwindcss/vite plugin. Marp generates standalone HTML with scoped styles.
   - What's unclear: If Tailwind CSS is globally applied, could it leak into presentation.html if served from same domain?
   - Recommendation: Marp HTML is self-contained with scoped styles in `<style>` tags. No conflict expected. Test by opening presentation.html in browser.

## Sources

### Primary (HIGH confidence)
- [Marp Official Site](https://marp.app/) - Core features, ecosystem overview
- [Marp CLI GitHub](https://github.com/marp-team/marp-cli) - Installation, CLI options, configuration
- [@marp-team/marp-cli npm](https://www.npmjs.com/package/@marp-team/marp-cli) - Version 4.2.3, latest 6 months ago
- [Marpit Directives Documentation](https://marpit.marp.app/directives) - Complete directive reference
- [Marp Core Themes README](https://github.com/marp-team/marp-core/blob/main/themes/README.md) - Built-in themes, CSS variables
- [Marp Guide: Directives](https://github.com/marp-team/marp/blob/main/website/docs/guide/directives.md) - All directives, syntax, examples
- [Marp CLI Transitions](https://github.com/marp-team/marp-cli/blob/main/docs/bespoke-transitions/README.md) - 33 transition effects, browser support

### Secondary (MEDIUM confidence)
- [Gaia Theme Example Gist](https://gist.github.com/yhatt/23d8470e053d9dfcb34cdc8f22c29200) - Frontmatter structure, class usage
- [Cybertopia Dark Theme](https://github.com/noraj/cybertopia-marp) - Dark theme CSS patterns, variable usage
- [Seven Tips for Marp](https://www.hashbangcode.com/article/seven-tips-getting-most-out-marp) - Best practices, common patterns
- [Creating Slides with Marp (Medium)](https://medium.com/@75py/creating-slides-with-marp-13dc35e36e4c) - GitHub Actions automation, npm scripts

### Tertiary (LOW confidence)
- WebSearch results on VitePress-Marp integration - No documented integration pattern found
- Community discussions on self-contained HTML - Monolith tool recommended but not deeply tested

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Official npm packages, clear versioning, documented installation
- Architecture: HIGH - Build script pattern verified in community examples, frontmatter structure from official docs
- Pitfalls: HIGH - Directive inheritance, HTML security, fragmented lists documented in official sources and GitHub issues
- VitePress integration: MEDIUM - No official integration, but standalone approach is standard and low-risk
- Custom theming: HIGH - CSS variable approach verified in Gaia theme source and community themes

**Research date:** 2026-02-16
**Valid until:** 2026-03-16 (30 days - Marp is stable, infrequent major changes)
